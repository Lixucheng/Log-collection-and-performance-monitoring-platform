<perf-layout :loading='loading' @getProject='getProject' :projectId='projectId' active='targetTable'>

  <div class="title" slot='title'>
    创建图表 {{project.name}} (共 {{list.length}} 个指标)
  </div>
  <div class="body perf-target-table-page" slot='body'>
    <el-row class='search-container'>
      <el-row class='search'>
        <el-form :inline='true' :model="searchData">
          <el-form-item>
            <el-autocomplete icon="search" class="inline-input" v-model="searchData.name" :fetch-suggestions="querySearch" placeholder="搜索或添加更多指标到图标"
              @select="addTargrt"></el-autocomplete>
          </el-form-item>
          <el-form-item>
            <el-date-picker v-model="timeZone" type="daterange" align="right" placeholder="选择日期范围" :picker-options="timeOPtions">
            </el-date-picker>
          </el-form-item>
          <el-form-item>
            <el-button @click='getData' type='success'><i class="el-icon-caret-right"></i></el-button>
          </el-form-item>
        </el-form>
      </el-row>
    </el-row>
    <el-table :data="showTargetList" stripe style="width: 100%">
      <el-table-column prop="value" label="指标">
      </el-table-column>
      <el-table-column label="添加分析维度">
        <template scope="scope">
          <el-select class='add-tag-select' v-model='seleteModel' placeholder="添加过滤器">
            <my-option @optionClick='setFilter(scope.row.value, item, true)' v-for="item in getTags(scope.row.value)" :key="item" :label="item"
              :value="item">
            </my-option>
          </el-select>
        </template>
      </el-table-column>
      <el-table-column width='400' label="分析维度">
        <template scope="scope">
          <div class='active-tag' v-for='(value, tag) in scope.row.filter' v-if='value.open'>
            <div class="tag-title">
              {{tag}}
            </div>
            <el-select v-model="showTarget[scope.row.value][tag].value" placeholder="请选择">
              <el-option v-for="item in targetData[scope.row.value][tag]" :key="item" :label="item" :value="item">
              </el-option>
            </el-select>
            <el-button @click='setFilter(scope.row.value, tag, false)' class='del-btn' size='small' type='danger'><i class="el-icon-close"></i></el-button>
          </div>
        </template>
      </el-table-column>
      <el-table-column width='150' label="操作">
        <template scope="scope">
          <el-button @click='deleteTarget(scope.row.value)' type='danger' size='small'>删除</el-button>
        </template>
      </el-table-column>
    </el-table>

    <div class='table' ref='table'></div>
  </div>

</perf-layout>
